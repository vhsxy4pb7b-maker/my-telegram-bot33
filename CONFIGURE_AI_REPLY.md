# 配置 AI 回复规则指南

## 📋 概述

系统提供了多种方式来配置 AI 的回复方式和规则。您可以通过修改配置文件来自定义 AI 的行为。

## 🔧 配置方法

### 方法 1: 修改 config.yaml 文件（推荐）

编辑 `config.yaml` 文件，修改 `ai_templates` 部分：

```yaml
# AI 回复模板
ai_templates:
  greeting: "您好！感谢您的咨询，我是AI智能客服，很高兴为您服务。"
  collecting_info: "为了更好地帮助您，请提供以下信息：姓名、联系方式、具体需求。"
  processing: "正在为您处理，请稍候..."
  fallback: "抱歉，我没有完全理解您的问题。能否详细描述一下您的需求？"
```

### 方法 2: 修改系统提示词（代码级别）

编辑 `src/ai/prompt_templates.py` 文件，修改 `build_system_prompt()` 方法：

```python
def build_system_prompt(self) -> str:
    """构建系统提示词"""
    return """你是一个专业的AI智能客服助手。你的职责是：
1. 友好、专业地回复客户咨询
2. 收集客户的基本信息（姓名、联系方式、需求等）
3. 理解客户意图，提供初步帮助
4. 如果无法解决，引导客户提供更多信息以便人工处理

请用中文回复，保持礼貌和专业。"""
```

## 📝 配置项说明

### 1. 回复模板（ai_templates）

#### greeting - 问候语
- **用途**: 客户首次联系时的问候语
- **示例**: "您好！感谢您的咨询，我是AI智能客服，很高兴为您服务。"

#### collecting_info - 收集信息提示
- **用途**: 当需要收集客户信息时使用
- **示例**: "为了更好地帮助您，请提供以下信息：姓名、联系方式、具体需求。"

#### processing - 处理中提示
- **用途**: 正在处理客户请求时的提示
- **示例**: "正在为您处理，请稍候..."

#### fallback - 默认回复
- **用途**: 当 AI 无法理解客户问题时使用
- **示例**: "抱歉，我没有完全理解您的问题。能否详细描述一下您的需求？"

### 2. 系统提示词（System Prompt）

系统提示词定义了 AI 的角色和行为准则。您可以在 `src/ai/prompt_templates.py` 中自定义。

#### 当前默认提示词

```
你是一个专业的AI智能客服助手。你的职责是：
1. 友好、专业地回复客户咨询
2. 收集客户的基本信息（姓名、联系方式、需求等）
3. 理解客户意图，提供初步帮助
4. 如果无法解决，引导客户提供更多信息以便人工处理

请用中文回复，保持礼貌和专业。
```

#### 自定义示例

**示例 1: 电商客服**
```python
def build_system_prompt(self) -> str:
    return """你是一个专业的电商客服助手。你的职责是：
1. 帮助客户了解产品信息、价格、库存等
2. 处理订单相关问题（下单、退款、物流等）
3. 收集客户反馈和建议
4. 遇到复杂问题，引导客户联系人工客服

回复要求：
- 使用友好、热情的语气
- 提供准确的产品信息
- 及时响应客户需求
- 保持专业和耐心

请用中文回复。"""
```

**示例 2: 技术支持客服**
```python
def build_system_prompt(self) -> str:
    return """你是一个技术支持客服助手。你的职责是：
1. 帮助客户解决技术问题
2. 提供产品使用指导
3. 收集问题详情以便技术人员跟进
4. 对于复杂问题，引导客户提交工单

回复要求：
- 使用专业、准确的技术术语
- 提供清晰的解决步骤
- 如果无法解决，诚实告知并引导人工支持

请用中文回复。"""
```

**示例 3: 销售客服**
```python
def build_system_prompt(self) -> str:
    return """你是一个销售客服助手。你的职责是：
1. 了解客户需求，推荐合适的产品或服务
2. 回答价格、优惠、套餐等问题
3. 收集客户联系方式和购买意向
4. 引导客户完成购买或预约

回复要求：
- 使用积极、专业的销售话术
- 突出产品优势和价值
- 适时询问客户需求
- 引导客户采取行动

请用中文回复。"""
```

## 🎯 高级配置

### 1. 修改 AI 模型参数

在 `.env` 文件中配置：

```env
OPENAI_MODEL=gpt-4          # 使用的模型（gpt-4, gpt-3.5-turbo 等）
OPENAI_TEMPERATURE=0.7      # 创造性（0-1，越高越有创造性）
```

### 2. 修改回复长度

编辑 `src/ai/reply_generator.py`，修改 `max_tokens` 参数：

```python
response = self.client.chat.completions.create(
    model=settings.openai_model,
    messages=messages,
    temperature=settings.openai_temperature,
    max_tokens=500  # 修改这个值来控制回复长度
)
```

### 3. 添加自定义回复规则

在 `src/ai/prompt_templates.py` 中添加新的模板方法：

```python
def get_custom_rule(self) -> str:
    """获取自定义规则"""
    return self.templates.get(
        "custom_rule",
        "您的自定义回复规则"
    )
```

然后在 `config.yaml` 中添加：

```yaml
ai_templates:
  custom_rule: "您的自定义回复规则"
```

## 📋 配置步骤

### 步骤 1: 编辑配置文件

1. 打开 `config.yaml` 文件
2. 找到 `ai_templates` 部分
3. 修改相应的模板文本

### 步骤 2: 自定义系统提示词（可选）

1. 打开 `src/ai/prompt_templates.py`
2. 修改 `build_system_prompt()` 方法
3. 根据您的业务需求自定义提示词

### 步骤 3: 重启服务

修改配置后，需要重启服务使配置生效：

```bash
# 停止当前服务（Ctrl+C）
# 重新启动
python run.py
```

## 💡 最佳实践

### 1. 明确角色定位
- 清楚定义 AI 的角色（客服、销售、技术支持等）
- 设定明确的服务范围和边界

### 2. 保持一致性
- 使用统一的语气和风格
- 保持品牌形象的一致性

### 3. 设置边界
- 明确告知 AI 什么能做，什么不能做
- 对于无法处理的情况，引导人工支持

### 4. 测试和优化
- 定期测试 AI 回复质量
- 根据实际效果调整提示词
- 收集客户反馈并改进

## 🔍 示例配置

### 完整示例 1: 电商客服

```yaml
# config.yaml
ai_templates:
  greeting: "您好！欢迎来到我们的商城，我是AI智能客服小助手，很高兴为您服务！有什么可以帮助您的吗？"
  collecting_info: "为了更好地为您服务，请提供以下信息：\n1. 您想了解的产品\n2. 您的联系方式\n3. 您的具体需求"
  processing: "正在为您查询，请稍候..."
  fallback: "抱歉，我没有完全理解您的问题。您可以：\n1. 重新描述您的问题\n2. 联系人工客服获取帮助"
```

```python
# src/ai/prompt_templates.py
def build_system_prompt(self) -> str:
    return """你是一个专业的电商客服助手。你的职责是：
1. 帮助客户了解产品信息、价格、库存、优惠活动等
2. 处理订单相关问题（下单、支付、退款、物流跟踪等）
3. 回答常见问题（退换货政策、配送范围、售后服务等）
4. 收集客户反馈和建议
5. 遇到复杂问题或投诉，引导客户联系人工客服

回复要求：
- 使用友好、热情、专业的语气
- 提供准确的产品和订单信息
- 及时响应客户需求
- 保持耐心和专业
- 如果无法解决，诚实告知并引导人工支持

请用中文回复，保持礼貌和专业。"""
```

### 完整示例 2: 技术支持

```yaml
# config.yaml
ai_templates:
  greeting: "您好！我是技术支持助手，可以帮助您解决产品使用中的问题。请描述您遇到的问题。"
  collecting_info: "为了更好地帮助您，请提供：\n1. 问题详细描述\n2. 产品型号/版本\n3. 您的联系方式\n4. 问题发生的时间"
  processing: "正在分析您的问题，请稍候..."
  fallback: "抱歉，我需要更多信息来帮助您。请详细描述：\n1. 您遇到的问题\n2. 您已经尝试的解决方法\n3. 错误信息（如果有）"
```

## 🆘 常见问题

### Q: 修改配置后没有生效？
A: 需要重启服务使配置生效。

### Q: 如何让 AI 回复更专业？
A: 在系统提示词中明确要求使用专业术语和表达方式。

### Q: 如何限制 AI 的回复长度？
A: 修改 `max_tokens` 参数，值越小回复越短。

### Q: 如何让 AI 更友好？
A: 在系统提示词中强调使用友好、热情的语气。

## 📚 相关文件

- **config.yaml** - 业务配置文件（包含回复模板）
- **src/ai/prompt_templates.py** - 提示词模板管理
- **src/ai/reply_generator.py** - AI 回复生成器
- **.env** - 环境变量配置（AI 模型参数）

## 🎯 下一步

1. 根据您的业务需求修改配置
2. 测试 AI 回复效果
3. 根据反馈优化配置
4. 定期更新和改进

