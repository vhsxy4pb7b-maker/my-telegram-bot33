# 系统功能简介

## 系统概述

这是一个完整的**多平台客服自动化系统**，主要支持 Facebook 和 Instagram 平台，实现从消息接收到人工审核的全流程自动化。

## 核心功能模块

### 1. 多平台消息接收 📱

- **Facebook 集成**
  - Webhook 消息接收
  - 私信、评论、广告消息处理
  - 消息验证和解析
  
- **Instagram 集成**
  - Instagram 消息接收（可选）
  - 跨平台统一处理

### 2. AI 智能回复 🤖

- **对话管理**
  - 维护对话上下文和历史记录
  - 多轮对话支持
  - 客户信息关联

- **智能回复生成**
  - 基于 OpenAI GPT 模型
  - 可配置的提示词模板
  - 上下文感知回复
  - 支持业务场景定制（如 iPhone 贷款业务）

### 3. 数据自动收集 📊

- **信息提取**
  - 自动提取客户姓名、邮箱、电话
  - 公司名称、位置信息
  - 需求描述和关键信息

- **数据验证**
  - 邮箱格式验证
  - 电话号码验证
  - 数据完整性检查

### 4. 智能过滤引擎 🔍

- **关键词过滤**
  - 垃圾消息过滤
  - 敏感词检测
  - 可配置过滤规则

- **优先级判断**
  - 自动识别紧急消息
  - 优先级分级（低、中、高、紧急）
  - 智能路由分配

- **情感分析**
  - 消息情感识别
  - 负面情绪预警

### 5. Telegram 通知与审核 📲

- **自动通知**
  - 新消息实时通知
  - 审核任务推送
  - 状态更新提醒

- **审核操作**
  - 通过 Telegram Bot 进行审核
  - 支持通过/拒绝操作
  - 审核备注和记录

### 6. 第三方集成 🔗

- **ManyChat 集成**
  - 与 ManyChat 平台对接
  - 消息同步处理

- **Botcake 集成**
  - 与 Botcake 平台对接
  - 统一消息管理

### 7. 数据统计与分析 📈

- **每日统计**
  - 接待客户数统计
  - 新客户/回头客分析
  - 消息量统计

- **引流统计**
  - 群组邀请发送数
  - 成功引流数
  - 引流转化率

- **开单统计**
  - 总开单数
  - 成功开单数
  - 开单转化率

- **问题分析**
  - 高频问题识别
  - 问题分类统计
  - 典型回复记录

### 8. 实时监控 🖥️

- **系统监控**
  - 实时消息处理状态
  - 系统健康检查
  - 性能指标监控

- **监控仪表板**
  - Web 界面实时监控
  - 数据可视化展示

### 9. 数据库管理 💾

- **数据模型**
  - 客户信息表
  - 对话记录表
  - 收集资料表
  - 审核记录表
  - 统计数据表

- **数据库迁移**
  - Alembic 版本控制
  - 自动迁移支持
  - 数据备份机制

### 10. 配置管理 ⚙️

- **环境配置**
  - 环境变量管理
  - 敏感信息保护
  - 多环境支持

- **业务配置**
  - YAML 配置文件
  - 自动回复模板配置
  - 过滤规则配置
  - 优先级规则配置

### 11. 工具模块 🛠️

- **配置检查器**
  - 自动检查配置完整性
  - 配置验证工具

- **令牌管理**
  - Facebook Token 管理
  - Token 刷新和更新
  - Token 验证工具

- **权限检查**
  - Facebook 权限验证
  - API 权限检查

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    Facebook/Instagram                    │
│                    (消息来源平台)                        │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                  Webhook 接收层                          │
│            (消息接收、验证、解析)                         │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                  消息处理管道                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐│
│  │消息接收  │→ │用户信息  │→ │过滤处理  │→ │AI回复    ││
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘│
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │数据收集  │→ │统计记录  │→ │通知发送  │             │
│  └──────────┘  └──────────┘  └──────────┘             │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                   数据库存储层                           │
│      (PostgreSQL/SQLite - 数据持久化)                   │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                  Telegram Bot 层                         │
│            (人工审核、通知、操作)                          │
└─────────────────────────────────────────────────────────┘
```

## 技术栈

- **后端框架**: FastAPI
- **数据库**: PostgreSQL / SQLite
- **ORM**: SQLAlchemy
- **数据库迁移**: Alembic
- **AI 服务**: OpenAI API (GPT-4)
- **消息平台**: 
  - Facebook Graph API
  - Instagram Graph API
  - Telegram Bot API
- **第三方集成**: 
  - ManyChat API
  - Botcake API
- **配置管理**: Pydantic Settings, PyYAML
- **异步处理**: asyncio, aiohttp

## 主要特性

✅ **自动化处理** - 从消息接收到回复全流程自动化  
✅ **智能过滤** - 自动过滤垃圾消息和低价值信息  
✅ **AI 辅助** - GPT-4 驱动的智能回复生成  
✅ **多平台支持** - Facebook、Instagram 统一处理  
✅ **实时通知** - Telegram 实时推送审核任务  
✅ **数据统计** - 完整的业务数据分析和报表  
✅ **可扩展性** - 模块化设计，易于扩展新功能  
✅ **高可用性** - 健康检查、错误处理、日志记录  

## 使用场景

1. **电商客服** - 自动回复客户咨询，收集订单信息
2. **业务咨询** - 自动筛选潜在客户，收集联系方式
3. **内容营销** - 自动回复评论，引导用户关注
4. **客户服务** - 7x24 小时自动客服，人工审核重要消息

## 系统状态

根据最新测试结果：
- ✅ **核心功能**: 100% 正常
- ✅ **测试通过率**: 88.4% (38/43)
- ✅ **系统稳定性**: 优秀

所有关键功能模块均已测试通过，系统运行正常。

## 快速开始

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **配置环境变量**
   ```bash
   cp .env.example .env
   # 编辑 .env 文件，填入 API 密钥等配置
   ```

3. **配置业务规则**
   ```bash
   cp config.yaml.example config.yaml
   # 编辑 config.yaml，配置业务规则
   ```

4. **初始化数据库**
   ```bash
   alembic upgrade head
   ```

5. **启动服务**
   ```bash
   python run.py
   ```

## 更多信息

- 详细文档: 查看 `README.md`
- API 文档: 启动服务后访问 `http://localhost:8000/docs`
- 测试报告: 查看 `tests/TEST_REPORT.md`
- 部署指南: 查看 `DEPLOYMENT_CHECKLIST.md`

---

**版本**: 2.0.0  
**最后更新**: 2024

