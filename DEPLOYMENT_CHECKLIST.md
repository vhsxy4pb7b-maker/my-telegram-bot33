# ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•

## âœ… éƒ¨ç½²å‰æ£€æŸ¥

### 1. é…ç½®æ£€æŸ¥

- [x] **Telegramç¾¤ç»„é…ç½®**
  - é…ç½®è·¯å¾„: `config/config.yaml`
  - å½“å‰å€¼: `https://t.me/+bNivsOGSM6ZlMGJl`
  - çŠ¶æ€: âœ… å·²é…ç½®

- [x] **Facebook Tokené…ç½®**
  - å·²é…ç½®é¡µé¢æ•°: 3
  - é¡µé¢1: `474610872412780` âœ… Tokenå·²é…ç½®
  - é¡µé¢2: `732287003311432` âœ… Tokenå·²é…ç½®
  - é¡µé¢3: `849418138246708` âœ… Tokenå·²é…ç½®
  - çŠ¶æ€: âœ… æ‰€æœ‰é¡µé¢Tokenå·²é…ç½®

- [x] **é¡µé¢è‡ªåŠ¨å›å¤è®¾ç½®**
  - é¡µé¢1: âœ… å·²å¯ç”¨
  - é¡µé¢2: âœ… å·²å¯ç”¨
  - é¡µé¢3: âœ… å·²å¯ç”¨
  - çŠ¶æ€: âœ… æ‰€æœ‰é¡µé¢å·²å¯ç”¨è‡ªåŠ¨å›å¤

- [x] **OpenAIé…ç½®**
  - API Key: âœ… å·²é…ç½®
  - Model: `gpt-4o-mini`
  - çŠ¶æ€: âœ… é…ç½®æ­£å¸¸

- [x] **æ•°æ®åº“é…ç½®**
  - Database URL: âœ… å·²é…ç½®
  - æ•°æ®åº“è¿æ¥: âœ… æˆåŠŸ
  - çŠ¶æ€: âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸

- [x] **Telegramé€šçŸ¥é…ç½®**
  - Bot Token: âœ… å·²é…ç½®
  - Chat ID: âœ… å·²é…ç½®
  - çŠ¶æ€: âœ… é…ç½®æ­£å¸¸

- [x] **AIæç¤ºè¯é…ç½®**
  - æç¤ºè¯ç±»å‹: `iphone_loan_telegram`
  - çŠ¶æ€: âœ… å·²é…ç½®

### 2. ä»£ç æ£€æŸ¥

- [x] **ä»£ç é”™è¯¯æ£€æŸ¥**
  - Linteré”™è¯¯: âœ… æ— é”™è¯¯
  - ä»£ç è´¨é‡: âœ… é€šè¿‡

- [x] **æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•**
  - æ™ºèƒ½åƒåœ¾ä¿¡æ¯æ£€æµ‹: âœ… 9/9é€šè¿‡
  - Telegramç¾¤é“¾æ¥æ£€æµ‹: âœ… é€šè¿‡
  - å›å¤ç”Ÿæˆé€»è¾‘: âœ… é€šè¿‡
  - é…ç½®åŠ è½½: âœ… é€šè¿‡
  - çŠ¶æ€: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

### 3. ä¾èµ–é¡¹æ£€æŸ¥

- [x] **Pythonä¾èµ–**
  - requirements.txt: âœ… å·²æ›´æ–°
  - ä¸»è¦ä¾èµ–:
    - FastAPI: 0.104.1
    - SQLAlchemy: 2.0.23
    - OpenAI: 1.3.5
    - httpx: 0.25.2
    - python-telegram-bot: 20.7

### 4. æ•°æ®åº“è¿ç§»

- [x] **è¿ç§»æ–‡ä»¶æ£€æŸ¥**
  - 001_initial_migration.py âœ…
  - 003_add_statistics_tables.py âœ…
  - 004_fix_index_names.py âœ…
  - 005_fix_timezone_defaults.py âœ…
  - 006_add_performance_indexes.py âœ…
  - çŠ¶æ€: âœ… æ‰€æœ‰è¿ç§»æ–‡ä»¶å­˜åœ¨

- [ ] **è¿è¡Œæ•°æ®åº“è¿ç§»**
  ```bash
  alembic upgrade head
  ```

### 5. ç¯å¢ƒå˜é‡æ£€æŸ¥

ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:

- [ ] `DATABASE_URL` - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- [ ] `FACEBOOK_APP_ID` - Facebookåº”ç”¨ID
- [ ] `FACEBOOK_APP_SECRET` - Facebookåº”ç”¨å¯†é’¥
- [ ] `FACEBOOK_VERIFY_TOKEN` - FacebookéªŒè¯ä»¤ç‰Œ
- [ ] `OPENAI_API_KEY` - OpenAI APIå¯†é’¥
- [ ] `TELEGRAM_BOT_TOKEN` - Telegramæœºå™¨äººä»¤ç‰Œ
- [ ] `TELEGRAM_CHAT_ID` - TelegramèŠå¤©ID
- [ ] `SECRET_KEY` - åº”ç”¨å¯†é’¥ï¼ˆç”¨äºJWTç­‰ï¼‰
- [ ] `CORS_ORIGINS` - CORSå…è®¸çš„æ¥æºï¼ˆç”Ÿäº§ç¯å¢ƒå¿…éœ€ï¼‰

### 6. åŠŸèƒ½éªŒè¯

- [x] **APIé”™è¯¯å¤„ç†**
  - 400é”™è¯¯å¤„ç†: âœ… å·²å®ç°
  - å•ä¸ªé¡µé¢å¤±è´¥ä¸å½±å“å…¶ä»–é¡µé¢: âœ… å·²å®ç°
  - çŠ¶æ€: âœ… é”™è¯¯å¤„ç†å®Œå–„

- [x] **APIé€Ÿç‡é™åˆ¶ä¿æŠ¤**
  - å¯¹è¯ä¹‹é—´å»¶è¿Ÿ: âœ… 0.3ç§’
  - æ¶ˆæ¯ä¹‹é—´å»¶è¿Ÿ: âœ… 0.5ç§’
  - æ¯10æ¡æ¶ˆæ¯å»¶è¿Ÿ: âœ… 1ç§’
  - çŠ¶æ€: âœ… é€Ÿç‡é™åˆ¶ä¿æŠ¤å·²å®ç°

- [x] **Telegramç¾¤é“¾æ¥æ£€æµ‹**
  - æ”¯æŒå¤šç§é“¾æ¥æ ¼å¼: âœ… å·²å®ç°
  - é‡å¤æ£€æµ‹: âœ… å·²å®ç°
  - çŠ¶æ€: âœ… åŠŸèƒ½å®Œå–„

- [x] **è‡ªåŠ¨å›å¤è°ƒåº¦å™¨**
  - æ‰«æé—´éš”: âœ… 5åˆ†é’Ÿ
  - å¤šé¡µé¢æ”¯æŒ: âœ… å·²å®ç°
  - æ¶ˆæ¯åŒæ­¥: âœ… å·²å®ç°
  - çŠ¶æ€: âœ… åŠŸèƒ½æ­£å¸¸

### 7. å®‰å…¨æ£€æŸ¥

- [ ] **Tokenå®‰å…¨**
  - Tokenå­˜å‚¨åœ¨å®‰å…¨ä½ç½®: `.page_tokens.json`
  - é•¿æœŸTokenå·²é…ç½®: âœ… å·²é…ç½®
  - Tokenè¿‡æœŸé¢„è­¦: âœ… å·²å®ç°

- [ ] **APIå¯†é’¥å®‰å…¨**
  - æ‰€æœ‰APIå¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®: âœ…
  - ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç : âœ…

- [ ] **CORSé…ç½®**
  - ç”Ÿäº§ç¯å¢ƒCORSå·²é…ç½®: âš ï¸ éœ€è¦æ£€æŸ¥
  - ä»…å…è®¸å¿…è¦çš„æ¥æº: âš ï¸ éœ€è¦é…ç½®

### 8. ç›‘æ§å’Œæ—¥å¿—

- [x] **æ—¥å¿—é…ç½®**
  - æ—¥å¿—æ–‡ä»¶: `logs/app.log`
  - æ—¥å¿—è½®è½¬: âœ… å·²é…ç½®ï¼ˆ10MBï¼Œ10ä¸ªå¤‡ä»½ï¼‰
  - æ—¥å¿—çº§åˆ«: INFO
  - çŠ¶æ€: âœ… æ—¥å¿—é…ç½®æ­£å¸¸

- [x] **å¥åº·æ£€æŸ¥**
  - å¥åº·æ£€æŸ¥ç«¯ç‚¹: `/health`
  - çŠ¶æ€: âœ… å·²å®ç°

### 9. éƒ¨ç½²æ­¥éª¤

1. **å¤‡ä»½å½“å‰ç‰ˆæœ¬**
   ```bash
   # å¤‡ä»½æ•°æ®åº“
   pg_dump database_name > backup_$(date +%Y%m%d_%H%M%S).sql
   
   # å¤‡ä»½ä»£ç 
   git tag v$(date +%Y%m%d_%H%M%S)
   ```

2. **æ›´æ–°ä»£ç **
   ```bash
   git pull origin main
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

4. **è¿è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   alembic upgrade head
   ```

5. **éªŒè¯é…ç½®**
   ```bash
   python scripts/tools/verify_production_config.py
   ```

6. **è¿è¡Œæµ‹è¯•**
   ```bash
   python scripts/tools/test_core_features.py
   ```

7. **å¯åŠ¨æœåŠ¡**
   ```bash
   python run.py
   # æˆ–ä½¿ç”¨ç”Ÿäº§æœåŠ¡å™¨
   gunicorn src.main:app -w 4 -k uvicorn.workers.UvicornWorker
   ```

8. **éªŒè¯æœåŠ¡**
   ```bash
   curl http://localhost:8000/health
   ```

### 10. éƒ¨ç½²åéªŒè¯

- [ ] **æœåŠ¡è¿è¡ŒçŠ¶æ€**
  - å¥åº·æ£€æŸ¥: `/health` è¿”å›200
  - æ—¥å¿—æ— é”™è¯¯: æ£€æŸ¥ `logs/app.log`

- [ ] **Webhookæ¥æ”¶**
  - å‘é€æµ‹è¯•æ¶ˆæ¯åˆ°Facebooké¡µé¢
  - æ£€æŸ¥æ—¥å¿—ç¡®è®¤æ¶ˆæ¯å·²æ¥æ”¶
  - æ£€æŸ¥æ•°æ®åº“ç¡®è®¤æ¶ˆæ¯å·²ä¿å­˜

- [ ] **è‡ªåŠ¨å›å¤åŠŸèƒ½**
  - å‘é€æµ‹è¯•æ¶ˆæ¯
  - ç¡®è®¤AIå·²å›å¤
  - æ£€æŸ¥å›å¤å†…å®¹æ˜¯å¦æ­£ç¡®

- [ ] **è‡ªåŠ¨æ‰«æåŠŸèƒ½**
  - ç­‰å¾…5åˆ†é’Ÿ
  - æ£€æŸ¥æ—¥å¿—ç¡®è®¤æ‰«æå·²è¿è¡Œ
  - æ£€æŸ¥æ˜¯å¦æœ‰æœªå›å¤æ¶ˆæ¯è¢«å¤„ç†

### 11. å›æ»šæ–¹æ¡ˆ

å¦‚æœéƒ¨ç½²åå‡ºç°é—®é¢˜:

1. **ç«‹å³å›æ»šä»£ç **
   ```bash
   git checkout <previous_tag>
   ```

2. **æ¢å¤æ•°æ®åº“**
   ```bash
   psql database_name < backup_file.sql
   ```

3. **é‡å¯æœåŠ¡**
   ```bash
   systemctl restart your_service_name
   ```

### 12. ç›‘æ§æŒ‡æ ‡

éƒ¨ç½²åéœ€è¦ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡:

- **å›å¤æˆåŠŸç‡**: æˆåŠŸå›å¤æ•° / æ€»æ¶ˆæ¯æ•°
- **é”™è¯¯ç‡**: é”™è¯¯æ•° / æ€»å¤„ç†æ•°
- **å¹³å‡å›å¤æ—¶é—´**: ä»æ”¶åˆ°æ¶ˆæ¯åˆ°å‘é€å›å¤çš„æ—¶é—´
- **APIè°ƒç”¨æˆåŠŸç‡**: APIè°ƒç”¨æˆåŠŸæ•° / æ€»è°ƒç”¨æ•°
- **ç³»ç»Ÿèµ„æºä½¿ç”¨**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨ç‡

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **Facebook APIç«¯ç‚¹é—®é¢˜**
   - `/conversations` ç«¯ç‚¹å¯èƒ½è¿”å›400é”™è¯¯
   - å·²ä¼˜é›…å¤„ç†ï¼Œä¸å½±å“æ•´ä½“åŠŸèƒ½
   - ç³»ç»Ÿä¸»è¦ä¾èµ–Webhookæ¥æ”¶æ¶ˆæ¯

2. **Tokenè¿‡æœŸ**
   - ä½¿ç”¨é•¿æœŸTokenï¼ˆ60å¤©ï¼‰
   - å®šæœŸæ£€æŸ¥Tokenè¿‡æœŸçŠ¶æ€
   - ä½¿ç”¨ `check_token_expiry.py` æ£€æŸ¥

3. **å¯¹è¯åºåˆ—è¾ƒçŸ­**
   - è¿™æ˜¯æ­£å¸¸ç°è±¡
   - ç³»ç»Ÿè®¾è®¡æ˜¯å¼•å¯¼å®¢æˆ·åˆ°Telegramç¾¤ç»„ç»§ç»­å¯¹è¯
   - Facebookä¸Šçš„å¯¹è¯ä¸»è¦ç”¨äºåˆå§‹æ¥è§¦å’Œå¼•æµ

## âœ… éƒ¨ç½²å‡†å¤‡çŠ¶æ€

- **é…ç½®**: âœ… å…¨éƒ¨é€šè¿‡
- **ä»£ç **: âœ… æ— é”™è¯¯
- **æµ‹è¯•**: âœ… å…¨éƒ¨é€šè¿‡
- **åŠŸèƒ½**: âœ… å…¨éƒ¨æ­£å¸¸

**ç³»ç»Ÿå·²å‡†å¤‡å¥½éƒ¨ç½²ï¼**

